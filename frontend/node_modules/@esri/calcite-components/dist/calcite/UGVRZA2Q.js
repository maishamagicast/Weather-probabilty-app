/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.3.2 */
import{b as A}from"./UO2RYA7M.js";import{a as E,b as L,c as I,d as D,f as _,h as b}from"./HC6HMGHC.js";import{k as F}from"./Z4WYDSRI.js";import{a as W,b as K}from"./JNDWDVLT.js";import{a as G,b as z}from"./EAMIZWRI.js";import{a as g}from"./7OWYG7K6.js";import{a as q}from"./K2CAW7RQ.js";import{a as B}from"./ABI4KTTI.js";import"./KFA3JWJG.js";import{a as T}from"./DZ2Q4CVO.js";import{a as N}from"./3HXHPF5E.js";import{a as U}from"./Z4YSXMEL.js";import"./ZXMLNJSJ.js";import"./MUWKU3CD.js";import"./U6YFXWCQ.js";import{g as R,t as v}from"./AAFHRQRJ.js";import{a as H}from"./XFVIIGHX.js";import{C,D as M,E as h,K as O,Q as k,g as w,h as d,o as m}from"./5IGT3AAH.js";var f={container:"container",table:"table",scrim:"scrim",stack:"stack",tableContainer:"table-container",sticky:"sticky-pos",assistiveText:"assistive-text",containerHeight:"container-height"},y={filterNoResults:"filter-no-results",filterActionsStart:"filter-actions-start",filterActionsEnd:"filter-actions-end"},j=w`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{position:relative;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.container-height{block-size:100%}.table-container{box-sizing:border-box;display:flex;inline-size:100%;flex-direction:column;background-color:transparent}.table-container *{box-sizing:border-box}.table{inline-size:100%}.stack{--calcite-stack-padding-inline: 0;--calcite-stack-padding-block: 0}.sticky-pos{position:sticky;inset-block-start:0px;z-index:var(--calcite-z-index-sticky);background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,J=`${L}, ${I}`,P=class extends M{constructor(){super(),this.dragSelector=I,this.focusableItems=[],this.handleSelector="calcite-sort-handle",this.listItems=[],this.listItemGroups=[],this.mutationObserver=T("mutation",()=>{this.willPerformFilter=!0,this.updateListItemsDebounced()}),this.cancelable=q()(this),this.updateListItemsDebounced=B(this.updateListItems,O.nextTick),this.visibleItems=[],this.willFilterEmit=!1,this.willPerformFilter=!1,this.messages=N({blocking:!0}),this.focusSetter=U()(this),this.dataForFilter=[],this.hasFilterActionsEnd=!1,this.hasFilterActionsStart=!1,this.hasFilterNoResults=!1,this.sortHandleMenuItems=[],this.disabled=!1,this.dragEnabled=!1,this.filterEnabled=!1,this.filteredData=[],this.filteredItems=[],this.interactionMode="interactive",this.loading=!1,this.displayMode="flat",this.scale="m",this.selectedItems=[],this.selectionAppearance="icon",this.selectionMode="none",this.sortDisabled=!1,this.calciteInternalListDefaultSlotChange=m({cancelable:!1}),this.calciteListChange=m({cancelable:!1}),this.calciteListDragEnd=m({cancelable:!1}),this.calciteListDragStart=m({cancelable:!1}),this.calciteListFilter=m({cancelable:!1}),this.calciteListMoveHalt=m({cancelable:!1}),this.calciteListOrderChange=m({cancelable:!1}),this.listen("calciteInternalListItemToggle",this.handleCalciteListItemToggle),this.listen("calciteInternalFocusPreviousItem",this.handleCalciteInternalFocusPreviousItem),this.listen("calciteInternalListItemActive",this.handleCalciteInternalListItemActive),this.listen("calciteListItemSelect",this.handleCalciteListItemSelect),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteListItemSortHandleBeforeOpen",this.updateListItemsDebounced),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteSortHandleAdd",this.handleSortAdd),this.listen("calciteInternalListItemSelect",this.handleCalciteInternalListItemSelect),this.listen("calciteInternalListItemSelectMultiple",this.handleCalciteInternalListItemSelectMultiple),this.listen("calciteInternalListItemChange",this.handleCalciteInternalListItemChange),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListItemGroupDefaultSlotChange)}static{this.properties={assistiveText:[16,{},{state:!0}],dataForFilter:[16,{},{state:!0}],hasFilterActionsEnd:[16,{},{state:!0}],hasFilterActionsStart:[16,{},{state:!0}],hasFilterNoResults:[16,{},{state:!0}],sortHandleMenuItems:[16,{},{state:!0}],canPull:[0,{},{attribute:!1}],canPut:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],dragEnabled:[7,{},{reflect:!0,type:Boolean}],filterEnabled:[7,{},{reflect:!0,type:Boolean}],filterPredicate:[0,{},{attribute:!1}],filterLabel:[3,{},{reflect:!0}],filterPlaceholder:[3,{},{reflect:!0}],filterProps:[0,{},{attribute:!1}],filterText:[3,{},{reflect:!0}],filteredData:[0,{},{attribute:!1}],filteredItems:[0,{},{attribute:!1}],group:[3,{},{reflect:!0}],interactionMode:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],displayMode:[3,{},{reflect:!0}],numberingSystem:1,scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],selectionAppearance:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}],sortDisabled:[7,{},{reflect:!0,type:Boolean}]}}static{this.styles=j}get hasActiveFilter(){return this.filterEnabled&&this.filterText&&this.filteredItems.length!==this.visibleItems.length}get showNoResultsContainer(){return this.filterEnabled&&this.filterText&&this.hasFilterNoResults&&this.visibleItems.length&&!this.filteredItems.length}async setFocus(e){return this.focusSetter(()=>this.filterEnabled?this.filterEl:this.focusableItems.find(t=>t.active),e)}emitOrderChangeEvent(e){this.calciteListOrderChange.emit(e)}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.willPerformFilter=!0,this.updateListItemsDebounced(),this.setUpSorting(),this.setParentList(),this.setListItemGroups(),this.cancelable.add(this.updateListItemsDebounced)}async load(){this.handleInteractionModeWarning()}willUpdate(e){(e.has("filterText")||e.has("filterProps")||e.has("filterPredicate"))&&this.performFilter(),(e.has("filterEnabled")&&(this.hasUpdated||this.filterEnabled!==!1)||e.has("group")||e.has("sortDisabled")&&(this.hasUpdated||this.sortDisabled!==!1)||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="none")||e.has("selectionAppearance")&&(this.hasUpdated||this.selectionAppearance!=="icon")||e.has("displayMode")&&this.hasUpdated||e.has("scale")&&this.hasUpdated||e.has("canPull")&&this.hasUpdated||e.has("canPut")&&this.hasUpdated||e.has("filterPredicate")&&this.hasUpdated)&&this.handleListItemChange()}updated(){G(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),K(this)}updateListItems(){this.updateGroupItems();let{selectionAppearance:e,selectionMode:t,interactionMode:s,dragEnabled:a,el:i,filterEl:n,displayMode:l,scale:r,sortDisabled:c,sortHandleMenuItems:u}=this,p=Array.from(this.el.querySelectorAll(I)),S=i,$=Array.from(S.children).filter(b);if(p.forEach(o=>{o.scale=r,o.selectionAppearance=e,o.selectionMode=t,o.interactionMode=s,o.closest(E)===i&&(o.moveToItems=u.filter(x=>this.validateSortMenuItem({type:"move",fromEl:S,toEl:x.element,dragEl:o,newIndex:0,oldIndex:$.indexOf(o)})),o.addToItems=this.sortHandleMenuItems.filter(x=>this.validateSortMenuItem({type:"add",fromEl:S,toEl:x.element,dragEl:o,newIndex:0,oldIndex:$.indexOf(o)})),o.dragHandle=a,o.displayMode=l,o.sortDisabled=c)}),this.parentListEl){this.setUpSorting();return}this.listItems=p,this.filterEnabled&&this.willPerformFilter&&(this.willPerformFilter=!1,this.dataForFilter=this.getItemData(),n&&(n.items=this.dataForFilter,this.filterAndUpdateData())),this.visibleItems=this.listItems.filter(o=>!o.closed&&!o.hidden),this.updateFilteredItems(),this.borderItems(),this.focusableItems=this.filteredItems.filter(o=>!o.disabled),this.setActiveListItem(),this.updateSelectedItems(),this.setUpSorting()}handleListItemChange(){this.willPerformFilter=!0,this.updateListItemsDebounced()}handleCalciteListItemToggle(e){this.parentListEl||(e.stopPropagation(),this.borderItems())}handleCalciteInternalFocusPreviousItem(e){if(this.parentListEl)return;e.stopPropagation();let{focusableItems:t}=this,a=t.findIndex(i=>i.active)-1;t[a]&&this.focusRow(t[a])}handleCalciteInternalListItemActive(e){if(this.parentListEl)return;e.stopPropagation();let t=e.target,{listItems:s}=this;s.forEach(a=>{a.active=a===t})}handleCalciteListItemSelect(){this.parentListEl||this.updateSelectedItems(!0)}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleReorder(e))}handleSortAdd(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleAdd(e))}handleSortMove(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleMove(e))}handleCalciteInternalListItemSelect(e){if(this.parentListEl)return;e.stopPropagation();let t=e.target,{listItems:s,selectionMode:a}=this;t.selected&&(a==="single"||a==="single-persist")&&s.forEach(i=>i.selected=i===t),this.updateSelectedItems()}handleCalciteInternalListItemSelectMultiple(e){if(this.parentListEl)return;e.stopPropagation();let{target:t,detail:s}=e,{focusableItems:a,lastSelectedInfo:i}=this,n=t;if(s.selectMultiple&&i){let l=a.indexOf(n),r=a.indexOf(i.selectedItem),c=Math.min(r,l),u=Math.max(r,l);a.slice(c,u+1).forEach(p=>p.selected=i.selected)}else this.lastSelectedInfo={selectedItem:n,selected:n.selected}}handleCalciteInternalListItemChange(e){this.parentListEl||(e.stopPropagation(),this.updateListItemsDebounced())}handleCalciteInternalListItemGroupDefaultSlotChange(e){e.stopPropagation()}connectObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){this.mutationObserver?.disconnect()}setUpSorting(){let{dragEnabled:e,defaultSlotEl:t}=this;e&&(t&&_(t),W(this))}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteListDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteListDragStart.emit(e)}onDragSort(e){this.setParentList(),this.updateListItemsDebounced(),this.calciteListOrderChange.emit(e)}setParentList(){this.parentListEl=this.el.parentElement?.closest(E)}handleDefaultSlotChange(){this.parentListEl&&this.calciteInternalListDefaultSlotChange.emit()}setListItemGroups(){this.listItemGroups=Array.from(this.el.querySelectorAll(L))}handleFilterActionsStartSlotChange(e){this.hasFilterActionsStart=v(e)}handleFilterActionsEndSlotChange(e){this.hasFilterActionsEnd=v(e)}handleFilterNoResultsSlotChange(e){this.hasFilterNoResults=v(e)}setActiveListItem(){let{focusableItems:e}=this;e.some(t=>t.active)||e[0]&&(e[0].active=!0)}async updateSelectedItems(e=!1){await this.updateComplete,this.selectedItems=this.visibleItems.filter(t=>t.selected),e&&this.calciteListChange.emit()}filterElements({el:e,filteredItems:t,visibleParents:s}){let a=!s.has(e)&&!t.includes(e);e.filterHidden=a;let i=e.parentElement.closest(J);i&&(a||s.add(i),this.filterElements({el:i,filteredItems:t,visibleParents:s}))}allParentListItemsExpanded(e){let t=e.parentElement?.closest(I);if(t){if(!t.expanded)return!1}else return!0;return this.allParentListItemsExpanded(t)}borderItems(){let e=this.visibleItems.filter(t=>!t.filterHidden&&this.allParentListItemsExpanded(t));e.forEach(t=>t.bordered=t!==e[e.length-1])}updateFilteredItems(){let{visibleItems:e,filteredData:t,filterText:s,filterPredicate:a}=this,i=e?.filter(r=>e.every(c=>c===r||!r.contains(c))),n=a?e.filter(a):s?t.map(r=>r.el):e||[],l=new WeakSet;i.forEach(r=>this.filterElements({el:r,filteredItems:n,visibleParents:l})),this.filteredItems=n,this.willFilterEmit&&(this.willFilterEmit=!1,this.calciteListFilter.emit())}updateFilteredData(){let{filterEl:e}=this;e&&(e.filteredItems&&(this.filteredData=e.filteredItems),this.updateListItemsDebounced())}async filterAndUpdateData(){await this.filterEl?.filter(this.filterText),this.updateFilteredData()}get effectiveFilterProps(){return this.filterProps?this.filterProps.filter(e=>e!=="el"):["description","label","metadata","heading"]}performFilter(){let{filterEl:e,filterText:t,effectiveFilterProps:s}=this;e&&(e.value=t,e.filterProps=s,this.filterAndUpdateData())}setDefaultSlotEl(e){this.defaultSlotEl=e}setFilterEl(e){this.filterEl=e,this.performFilter()}handleFilterChange(e){e.stopPropagation();let{value:t}=e.currentTarget;this.filterText=t,this.willFilterEmit=!0,this.updateFilteredData()}getItemData(){return this.listItems.map(e=>({label:e.label,description:e.description,metadata:e.metadata,heading:this.getGroupHeading(e),el:e}))}getGroupHeading(e){return this.listItemGroups.filter(s=>s.contains(e)).map(s=>s.heading)}updateGroupItems(){let{el:e,group:t,scale:s}=this,a=R(e),i=t?Array.from(a.querySelectorAll(`${E}[group="${t}"]`)).filter(l=>!l.disabled&&l.dragEnabled):[];this.sortHandleMenuItems=i.map(l=>({element:l,label:l.label??l.id,id:H()})),Array.from(this.el.querySelectorAll(L)).forEach(l=>{l.scale=s})}focusRow(e){let{focusableItems:t}=this;e&&(t.forEach(s=>s.active=s===e),e.setFocus())}isNavigable(e){let t=e.parentElement?.closest(I);return t?t.expanded&&this.isNavigable(t):!0}handleListKeydown(e){if(e.defaultPrevented||this.parentListEl)return;let{key:t}=e,s=this.focusableItems.filter(i=>this.isNavigable(i)),a=s.findIndex(i=>i.active);if(t==="ArrowDown"){e.preventDefault();let i=e.target===this.filterEl?0:a+1;s[i]&&this.focusRow(s[i])}else if(t==="ArrowUp"){if(e.preventDefault(),a===0&&this.filterEnabled){this.filterEl.setFocus();return}let i=a-1;s[i]&&this.focusRow(s[i])}else if(t==="Home"){e.preventDefault();let i=s[0];i&&this.focusRow(i)}else if(t==="End"){e.preventDefault();let i=s[s.length-1];i&&this.focusRow(i)}}handleInteractionModeWarning(){this.interactionMode==="static"&&this.selectionMode!=="none"&&this.selectionAppearance==="border"&&console.warn('selection-appearance="border" requires interaction-mode="interactive"')}validateSortMenuItem({fromEl:e,toEl:t,dragEl:s,newIndex:a,oldIndex:i,type:n}){if(!e||!t||t===e||s.contains(t))return!1;let l=e.canPull?.({toEl:t,fromEl:e,dragEl:s,newIndex:a,oldIndex:i})??!0,r=t.canPut?.({toEl:t,fromEl:e,dragEl:s,newIndex:a,oldIndex:i})??!0;return(n==="add"?l==="clone":l===!0)&&r}handleAdd(e){let{addTo:t}=e.detail,s=e.target,a=s?.parentElement,i=t.element,l=Array.from(a.children).filter(b).indexOf(s),r=0;if(!this.validateSortMenuItem({type:"add",fromEl:a,toEl:i,dragEl:s,newIndex:r,oldIndex:l}))return;s.sortHandleOpen=!1,this.disconnectObserver();let c=s.cloneNode();i.prepend(c),D(s),this.updateListItemsDebounced(),this.connectObserver();let u={dragEl:s,fromEl:a,toEl:i,newIndex:r,oldIndex:l};this.calciteListOrderChange.emit(u),i.emitOrderChangeEvent(u)}handleMove(e){let{moveTo:t}=e.detail,s=e.target,a=s?.parentElement,i=t.element,l=Array.from(a.children).filter(b).indexOf(s),r=0;if(!this.validateSortMenuItem({type:"move",fromEl:a,toEl:i,dragEl:s,newIndex:r,oldIndex:l}))return;s.sortHandleOpen=!1,this.disconnectObserver(),i.prepend(s),D(s),this.updateListItemsDebounced(),this.connectObserver();let c={dragEl:s,fromEl:a,toEl:i,newIndex:r,oldIndex:l};this.calciteListOrderChange.emit(c),i.emitOrderChangeEvent(c)}handleReorder(e){let{reorder:t}=e.detail,s=e.target,a=s?.parentElement;if(!a)return;s.sortHandleOpen=!1;let i=Array.from(a.children).filter(b),n=i.length-1,l=i.indexOf(s),r=l;switch(t){case"top":r=0;break;case"bottom":r=n;break;case"up":r=l===0?0:l-1;break;case"down":r=l===n?n:l+1;break}this.disconnectObserver();let c=t==="up"||t==="top"?i[r]:i[r].nextSibling;a.insertBefore(s,c),this.updateListItemsDebounced(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:s,fromEl:a,toEl:a,newIndex:r,oldIndex:l})}render(){let{loading:e,label:t,disabled:s,dataForFilter:a,filterEnabled:i,filterPlaceholder:n,filterText:l,filterLabel:r,hasFilterActionsStart:c,hasFilterActionsEnd:u,effectiveFilterProps:p}=this;return z({disabled:this.disabled,children:d`<div class=${h({[f.container]:!0,[f.containerHeight]:this.listItems.length<1&&e})}>${this.dragEnabled?d`<span aria-live=assertive class=${h(f.assistiveText)}>${this.assistiveText}</span>`:null}${this.renderItemAriaLive()}${e?d`<calcite-scrim class=${h(f.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${t||""} class=${h(f.table)} @keydown=${this.handleListKeydown} role=treegrid>${i||c||u?d`<div class=${h(f.sticky)} role=rowgroup><div role=row><div role=columnheader><calcite-stack class=${h(f.stack)}><slot name=${y.filterActionsStart} @slotchange=${this.handleFilterActionsStartSlotChange} slot=${A.actionsStart}></slot><calcite-filter .ariaLabel=${n} .disabled=${s} .filterProps=${p} .items=${a} .label=${r} @calciteFilterChange=${this.handleFilterChange} .placeholder=${n} .scale=${this.scale} .value=${l} ${C(this.setFilterEl)}></calcite-filter><slot name=${y.filterActionsEnd} @slotchange=${this.handleFilterActionsEndSlotChange} slot=${A.actionsEnd}></slot></calcite-stack></div></div></div>`:null}<div class=${h(f.tableContainer)} role=rowgroup><slot @slotchange=${this.handleDefaultSlotChange} ${C(this.setDefaultSlotEl)}></slot></div></div><div aria-live=polite data-test-id=no-results-container .hidden=${!this.showNoResultsContainer}><slot name=${y.filterNoResults} @slotchange=${this.handleFilterNoResultsSlotChange}></slot></div></div>`})}renderItemAriaLive(){let{messages:e,filteredItems:t,parentListEl:s,messages:{_lang:a},numberingSystem:i}=this;return F.numberFormatOptions={locale:a,numberingSystem:i},s?null:d`<div aria-live=polite class=${h(f.assistiveText)}>${this.hasActiveFilter?g("aria-filter-enabled",d`<div>${e.filterEnabled}</div>`):null}${g("aria-item-count",d`<div>${e.total.replace("{count}",F.localize(t.length.toString()))}</div>`)}${t.length?g("aria-item-list",d`<ol>${t.map(n=>d`<li>${n.label}</li>`)}</ol>`):null}</div>`}};k("calcite-list",P);export{P as List};
